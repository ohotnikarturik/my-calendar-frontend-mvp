<div class="contacts-container">
  <!-- Header with title and controls -->
  <div class="contacts-header">
    <h1>{{ "contacts.title" | translate }}</h1>
    <div class="header-controls">
      <!-- Search input -->
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>{{ "contacts.searchContacts" | translate }}</mat-label>
        <input
          matInput
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
          [placeholder]="'contacts.searchPlaceholder' | translate"
        />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <!-- Add contact button -->
      <button
        mat-raised-button
        color="primary"
        (click)="openContactModal()"
        [matTooltip]="'contacts.addNewContact' | translate"
      >
        <mat-icon>person_add</mat-icon>
        {{ "buttons.addContact" | translate }}
      </button>
    </div>
  </div>

  <!-- Loading state -->
  @if (contactsService.loading()) {
  <div class="loading-state">
    <mat-spinner diameter="48"></mat-spinner>
    <p>{{ "common.loadingContacts" | translate }}</p>
  </div>
  } @else if (filteredContacts().length === 0) {
  <!-- Empty state -->
  <div class="empty-state">
    @if (searchQuery()) {
    <!-- No search results -->
    <mat-icon>search_off</mat-icon>
    <p>{{ "contacts.noResults" | translate : { query: searchQuery() } }}</p>
    <p class="empty-subtitle">
      {{ "contacts.tryDifferentSearch" | translate }}
    </p>
    <button mat-button (click)="searchQuery.set('')">
      <mat-icon>clear</mat-icon>
      {{ "buttons.clearSearch" | translate }}
    </button>
    } @else {
    <!-- No contacts at all -->
    <mat-icon>person_add</mat-icon>
    <p>{{ "contacts.noContacts" | translate }}</p>
    <p class="empty-subtitle">{{ "contacts.noContactsDesc" | translate }}</p>
    <button mat-raised-button color="primary" (click)="openContactModal()">
      <mat-icon>add</mat-icon>
      {{ "buttons.addFirstContact" | translate }}
    </button>
    }
  </div>
  } @else {
  <!-- Contact count -->
  <div class="contacts-count">
    <span>{{
      "contacts.contactCount" | translate : { count: filteredContacts().length }
    }}</span>
    @if (searchQuery()) {
    <span class="search-info">{{
      "contacts.matching" | translate : { query: searchQuery() }
    }}</span>
    }
  </div>

  <!-- Contacts grid -->
  <div class="contacts-grid">
    @for (contact of filteredContacts(); track contact.id) {
    <mat-card class="contact-card" (click)="openContactModal(contact)">
      <!-- Contact avatar with initials -->
      <div class="contact-avatar">
        {{ getInitials(contact) }}
      </div>

      <mat-card-content>
        <h3 class="contact-name">
          {{ contact.firstName }} {{ contact.lastName }}
        </h3>

        @if (contact.email) {
        <div class="contact-detail">
          <mat-icon>email</mat-icon>
          <a
            [href]="'mailto:' + contact.email"
            (click)="$event.stopPropagation()"
          >
            {{ contact.email }}
          </a>
        </div>
        } @if (contact.phone) {
        <div class="contact-detail">
          <mat-icon>phone</mat-icon>
          <a [href]="'tel:' + contact.phone" (click)="$event.stopPropagation()">
            {{ contact.phone }}
          </a>
        </div>
        } @if (contact.notes) {
        <p class="contact-notes">{{ contact.notes }}</p>
        }
      </mat-card-content>

      <!-- Edit indicator -->
      <div class="edit-indicator">
        <mat-icon>edit</mat-icon>
      </div>
    </mat-card>
    }
  </div>
  }
</div>
