<section class="event-modal">
  <h2 mat-dialog-title class="modal-title">{{ dialogTitle() }}</h2>

  <form
    class="event-form"
    [formGroup]="eventForm"
    (ngSubmit)="onSave()"
    [attr.aria-label]="'eventModal.editTitle' | translate"
  >
    <div mat-dialog-content class="modal-content">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "eventModal.eventTitle" | translate }}</mat-label>
        <input
          matInput
          formControlName="title"
          [attr.maxlength]="titleMaxLength"
          [placeholder]="'eventModal.eventTitlePlaceholder' | translate"
          autocomplete="off"
          required
          [attr.aria-label]="'eventModal.eventTitle' | translate"
          aria-required="true"
        />
        <mat-hint align="end">{{ titleUsage() }}</mat-hint>
        @if (shouldShowError('title') && hasError('title', 'required')) {
        <mat-error>{{ "validation.titleRequired" | translate }}</mat-error>
        } @if (shouldShowError('title') && hasError('title', 'maxlength')) {
        <mat-error>{{
          "validation.titleMaxLength" | translate : { max: titleMaxLength }
        }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "eventModal.description" | translate }}</mat-label>
        <textarea
          matInput
          formControlName="description"
          rows="3"
          [placeholder]="'eventModal.descriptionPlaceholder' | translate"
          [attr.aria-label]="'eventModal.description' | translate"
        ></textarea>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "eventModal.eventDate" | translate }}</mat-label>
        <input
          matInput
          [matDatepicker]="datePicker"
          formControlName="date"
          [attr.aria-label]="'eventModal.eventDate' | translate"
          aria-required="true"
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="datePicker"
          [attr.aria-label]="'eventModal.openCalendar' | translate"
        ></mat-datepicker-toggle>
        <mat-datepicker
          #datePicker
          panelClass="custom-calendar"
        ></mat-datepicker>
        @if (shouldShowError('date') && hasError('date', 'required')) {
        <mat-error>{{ "validation.dateRequired" | translate }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "eventModal.category" | translate }}</mat-label>
        <mat-select
          formControlName="category"
          [attr.aria-label]="'eventModal.category' | translate"
        >
          @for (option of categoryOptions; track option.value) {
          <mat-option [value]="option.value">{{ option.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "eventModal.color" | translate }}</mat-label>
        <mat-select
          formControlName="color"
          [attr.aria-label]="'eventModal.color' | translate"
        >
          @for (option of colorOptions; track option.value) {
          <mat-option [value]="option.value">
            <span class="color-option">
              <span
                class="color-preview"
                [style.background-color]="option.color"
              ></span>
              {{ option.label }}
            </span>
          </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-slide-toggle
        formControlName="repeatAnnually"
        [attr.aria-label]="'eventModal.repeatAnnually' | translate"
      >
        {{ "eventModal.repeatAnnually" | translate }}
      </mat-slide-toggle>

      <div class="reminder-section">
        <mat-slide-toggle
          formControlName="reminderEnabled"
          [attr.aria-label]="'eventModal.enableReminders' | translate"
        >
          {{ "eventModal.enableReminders" | translate }}
        </mat-slide-toggle>

        @if (eventForm.get('reminderEnabled')?.value) {
        <mat-form-field
          appearance="outline"
          class="full-width reminder-days-field"
        >
          <mat-label>{{ "eventModal.remindMe" | translate }}</mat-label>
          <mat-select
            formControlName="reminderDaysBefore"
            [attr.aria-label]="'eventModal.remindMe' | translate"
          >
            @for (option of reminderDayOptions; track option.value) {
            <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        }
      </div>
    </div>

    <div mat-dialog-actions class="modal-actions">
      <button
        mat-button
        type="button"
        (click)="onCancel()"
        [attr.aria-label]="'aria.cancelDialog' | translate"
      >
        {{ "buttons.cancel" | translate }}
      </button>
      @if (canDelete()) {
      <button
        mat-button
        color="warn"
        type="button"
        (click)="onDelete()"
        [attr.aria-label]="'aria.deleteEvent' | translate"
      >
        {{ "buttons.delete" | translate }}
      </button>
      }
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="!canSubmit()"
        [attr.aria-label]="primaryActionLabel()"
      >
        {{ primaryActionLabel() }}
      </button>
    </div>
  </form>
</section>
