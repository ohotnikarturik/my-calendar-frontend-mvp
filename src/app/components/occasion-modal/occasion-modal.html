<section class="occasion-modal">
  <h2 mat-dialog-title class="modal-title">{{ dialogTitle() }}</h2>

  <form class="occasion-form" [formGroup]="occasionForm" (ngSubmit)="onSave()">
    <div mat-dialog-content class="modal-content">
      <!-- Contact Selector -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "common.contact" | translate }}</mat-label>
        <mat-select formControlName="contactId" required>
          @for (contact of contacts(); track contact.id) {
          <mat-option [value]="contact.id">
            {{ getContactName(contact) }}
          </mat-option>
          }
        </mat-select>
        @if (shouldShowError('contactId') && hasError('contactId', 'required'))
        {
        <mat-error>{{ "validation.contactRequired" | translate }}</mat-error>
        } @if (contacts().length === 0) {
        <mat-hint>{{ "occasionModal.noContacts" | translate }}</mat-hint>
        }
      </mat-form-field>

      <!-- Occasion Type -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "occasionModal.occasionType" | translate }}</mat-label>
        <mat-select formControlName="type" required>
          @for (option of occasionTypeOptions; track option.value) {
          <mat-option [value]="option.value">
            {{ option.label }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- Title -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "occasionModal.title" | translate }}</mat-label>
        <input
          matInput
          formControlName="title"
          [placeholder]="'occasionModal.titlePlaceholder' | translate"
          maxlength="120"
          required
        />
        @if (shouldShowError('title') && hasError('title', 'required')) {
        <mat-error>{{ "validation.titleRequired" | translate }}</mat-error>
        }
      </mat-form-field>

      <!-- Date -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ "occasionModal.date" | translate }}</mat-label>
        <input
          matInput
          [matDatepicker]="datePicker"
          formControlName="date"
          required
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="datePicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #datePicker></mat-datepicker>
        @if (shouldShowError('date') && hasError('date', 'required')) {
        <mat-error>{{ "validation.dateRequired" | translate }}</mat-error>
        }
      </mat-form-field>

      <!-- Year toggle and input -->
      <div class="year-section">
        <mat-slide-toggle formControlName="hasYear">
          {{ "occasionModal.includeYear" | translate }}
        </mat-slide-toggle>
        <mat-hint class="year-hint">
          {{ "occasionModal.includeYearHint" | translate }}
        </mat-hint>

        @if (showYearField()) {
        <mat-form-field appearance="outline" class="year-field">
          <mat-label>{{ "occasionModal.year" | translate }}</mat-label>
          <input
            matInput
            type="number"
            formControlName="year"
            [placeholder]="'occasionModal.yearPlaceholder' | translate"
            min="1900"
            [max]="2100"
          />
        </mat-form-field>
        }
      </div>

      <!-- Repeat Annually -->
      <mat-slide-toggle formControlName="repeatAnnually">
        {{ "occasionModal.repeatAnnually" | translate }}
      </mat-slide-toggle>

      <!-- Reminder Section -->
      <div class="reminder-section">
        <mat-slide-toggle formControlName="reminderEnabled">
          {{ "occasionModal.enableReminders" | translate }}
        </mat-slide-toggle>

        @if (occasionForm.get('reminderEnabled')?.value) {
        <mat-form-field
          appearance="outline"
          class="full-width reminder-days-field"
        >
          <mat-label>{{ "occasionModal.remindMe" | translate }}</mat-label>
          <mat-select formControlName="reminderDaysBefore">
            @for (option of reminderDayOptions; track option.value) {
            <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        }
      </div>
    </div>

    <!-- Dialog Actions -->
    <div mat-dialog-actions class="modal-actions">
      <button mat-button type="button" (click)="onCancel()">
        {{ "buttons.cancel" | translate }}
      </button>
      @if (canDelete()) {
      <button mat-button color="warn" type="button" (click)="onDelete()">
        {{ "buttons.delete" | translate }}
      </button>
      }
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="!canSubmit()"
      >
        {{ primaryActionLabel() }}
      </button>
    </div>
  </form>
</section>
