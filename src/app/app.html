<mat-sidenav-container class="sidenav-container">
  <!-- Mobile sidebar drawer -->
  <mat-sidenav
    #drawer
    class="sidenav"
    mode="over"
    [fixedInViewport]="true"
    [fixedTopGap]="0"
    [fixedBottomGap]="0"
  >
    <mat-nav-list>
      <div class="sidenav-header">
        <h2>{{ "nav.appTitle" | translate }}</h2>
        <button
          mat-icon-button
          (click)="closeDrawer()"
          [attr.aria-label]="'nav.closeMenu' | translate"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>

      @if (supabase.isInitialized() && isAuthenticated()) {
      <a
        mat-list-item
        routerLink="/home"
        routerLinkActive="active"
        (click)="closeDrawer()"
      >
        <mat-icon matListItemIcon>home</mat-icon>
        <span matListItemTitle>{{ "nav.home" | translate }}</span>
      </a>
      <a
        mat-list-item
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        (click)="closeDrawer()"
      >
        <mat-icon matListItemIcon>calendar_month</mat-icon>
        <span matListItemTitle>{{ "nav.calendar" | translate }}</span>
      </a>
      <a
        mat-list-item
        routerLink="/upcoming"
        routerLinkActive="active"
        (click)="closeDrawer()"
      >
        <mat-icon matListItemIcon>event</mat-icon>
        <span matListItemTitle>{{ "nav.upcoming" | translate }}</span>
      </a>
      <!-- <a mat-list-item routerLink="/contacts" routerLinkActive="active" (click)="closeDrawer()">
        <mat-icon matListItemIcon>contacts</mat-icon>
        <span matListItemTitle>Contacts</span>
      </a> -->
      <!-- <a mat-list-item routerLink="/occasions" routerLinkActive="active" (click)="closeDrawer()">
        <mat-icon matListItemIcon>cake</mat-icon>
        <span matListItemTitle>Occasions</span>
      </a> -->
      <a
        mat-list-item
        routerLink="/settings"
        routerLinkActive="active"
        (click)="closeDrawer()"
      >
        <mat-icon matListItemIcon>settings</mat-icon>
        <span matListItemTitle>{{ "nav.settings" | translate }}</span>
      </a>
      <a
        mat-list-item
        routerLink="/about"
        routerLinkActive="active"
        (click)="closeDrawer()"
      >
        <mat-icon matListItemIcon>info</mat-icon>
        <span matListItemTitle>{{ "nav.about" | translate }}</span>
      </a>

      <mat-divider></mat-divider>

      <!-- Language toggle in sidebar -->
      <a
        mat-list-item
        [matMenuTriggerFor]="mobileLangMenu"
        tabindex="0"
        [attr.aria-label]="'aria.selectLanguage' | translate"
      >
        <mat-icon matListItemIcon>language</mat-icon>
        <span matListItemTitle>{{ currentLanguageName() }}</span>
      </a>
      <mat-menu #mobileLangMenu="matMenu">
        @for (lang of supportedLanguages; track lang.code) {
        <button
          mat-menu-item
          (click)="changeLanguage(lang.code)"
          [class.active]="currentLanguage() === lang.code"
        >
          @if (currentLanguage() === lang.code) {
          <mat-icon>check</mat-icon>
          }
          <span>{{ lang.nativeName }}</span>
        </button>
        }
      </mat-menu>

      <!-- Theme toggle in sidebar -->
      <a
        mat-list-item
        (click)="toggleTheme()"
        (keydown.enter)="toggleTheme()"
        (keydown.space)="toggleTheme()"
        tabindex="0"
        [attr.aria-label]="themeTooltip()"
      >
        <mat-icon matListItemIcon>{{ themeIcon() }}</mat-icon>
        <span matListItemTitle>{{ themeTooltip() }}</span>
      </a>

      <mat-divider></mat-divider>

      <!-- User info and logout -->
      <div class="sidenav-user">
        <mat-icon>account_circle</mat-icon>
        <span class="user-email">{{ userEmail() }}</span>
      </div>
      <a
        mat-list-item
        (click)="onLogout(); closeDrawer()"
        (keydown.enter)="onLogout(); closeDrawer()"
        (keydown.space)="onLogout(); closeDrawer()"
        tabindex="0"
        [attr.aria-label]="'aria.signOutAccount' | translate"
      >
        <mat-icon matListItemIcon>logout</mat-icon>
        <span matListItemTitle>{{ "nav.signOut" | translate }}</span>
      </a>
      } @else if (supabase.isInitialized()) {
      <!-- Login option when not authenticated -->
      <a
        mat-list-item
        routerLink="/auth/login"
        (click)="closeDrawer()"
        [attr.aria-label]="'aria.signInAccount' | translate"
      >
        <mat-icon matListItemIcon>login</mat-icon>
        <span matListItemTitle>{{ "nav.signIn" | translate }}</span>
      </a>
      }
    </mat-nav-list>
  </mat-sidenav>

  <!-- Main content with navigation -->
  <mat-sidenav-content>
    <nav class="main-nav">
      <content-wrapper>
        <div class="nav-content">
          <!-- Left side: Hamburger (mobile) + Logo -->
          <div class="nav-left">
            <button
              mat-icon-button
              class="hamburger-button"
              (click)="toggleDrawer()"
              [attr.aria-label]="'nav.openMenu' | translate"
            >
              <mat-icon>menu</mat-icon>
            </button>
            <a routerLink="/" class="app-title-link">
              <h1 class="app-title">{{ "nav.appTitle" | translate }}</h1>
            </a>
          </div>

          <!-- Right side: Desktop navigation -->
          <div class="nav-links desktop-nav">
            @if (supabase.isInitialized() && isAuthenticated()) {
            <a routerLink="/home" routerLinkActive="active">{{
              "nav.home" | translate
            }}</a>
            <a
              routerLink="/"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              >{{ "nav.calendar" | translate }}</a
            >
            <a routerLink="/upcoming" routerLinkActive="active">{{
              "nav.upcoming" | translate
            }}</a>
            <!-- <a routerLink="/contacts" routerLinkActive="active">Contacts</a> -->
            <!-- <a routerLink="/occasions" routerLinkActive="active">Occasions</a> -->
            <a routerLink="/settings" routerLinkActive="active">{{
              "nav.settings" | translate
            }}</a>
            <a routerLink="/about" routerLinkActive="active">{{
              "nav.about" | translate
            }}</a>
            }

            <!-- Language switcher -->
            <button
              mat-button
              class="language-toggle"
              [matMenuTriggerFor]="languageMenu"
              [matTooltip]="'Language: ' + currentLanguageName()"
              [attr.aria-label]="'aria.selectLanguage' | translate"
            >
              <mat-icon>language</mat-icon>
              <span>{{ currentLanguageCode() }}</span>
            </button>
            <mat-menu #languageMenu="matMenu">
              @for (lang of supportedLanguages; track lang.code) {
              <button
                mat-menu-item
                (click)="changeLanguage(lang.code)"
                [class.active]="currentLanguage() === lang.code"
              >
                @if (currentLanguage() === lang.code) {
                <mat-icon>check</mat-icon>
                }
                <span>{{ lang.nativeName }}</span>
              </button>
              }
            </mat-menu>

            <!-- Theme toggle button -->
            <button
              mat-icon-button
              class="theme-toggle"
              (click)="toggleTheme()"
              [matTooltip]="themeTooltip()"
              [attr.aria-label]="themeTooltip()"
            >
              <mat-icon>{{ themeIcon() }}</mat-icon>
            </button>

            <!-- Auth button -->
            @if (supabase.isInitialized() && isAuthenticated()) {
            <!-- User menu when logged in -->
            <button
              mat-icon-button
              [matMenuTriggerFor]="userMenu"
              class="user-menu-button"
              [matTooltip]="userEmail() ?? 'Account'"
              [attr.aria-label]="'aria.openUserMenu' | translate"
            >
              <mat-icon>account_circle</mat-icon>
            </button>
            <mat-menu #userMenu="matMenu">
              <div class="user-menu-header">
                <mat-icon>email</mat-icon>
                <span>{{ userEmail() }}</span>
              </div>
              <button
                mat-menu-item
                (click)="onLogout()"
                [attr.aria-label]="'aria.signOutAccount' | translate"
              >
                <mat-icon>logout</mat-icon>
                <span>{{ "nav.signOut" | translate }}</span>
              </button>
            </mat-menu>
            } @else if (supabase.isInitialized()) {
            <!-- Login button when not logged in -->
            <a
              mat-stroked-button
              routerLink="/auth/login"
              class="login-button"
              [attr.aria-label]="'aria.signInAccount' | translate"
            >
              {{ "nav.signIn" | translate }}
            </a>
            }
          </div>
        </div>
      </content-wrapper>
    </nav>

    <main class="main-content">
      <content-wrapper>
        <router-outlet />
      </content-wrapper>
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>
